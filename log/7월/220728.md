## 220728

1. 데이터 숫자 중복 해결

- 해결방안

    + ㄱ. 먼저, template 이 사람이 직접 중복된 수를 제거했는지 확인하자. 그렇다면, 숫자를 중복되지 않게 변경하여, 데이터를 다 살릴 수 있다.
        * (사람은 equation 만 작성하였기에, 구분할 수 없음)

    + ㄴ. 현재, 숫자 중복 현황을 확인하자. 그 숫자가 적다면, 제거하자.
        * (제거하기엔 너무 많다.)

    + ㄷ. 우선 제거하고, train valid test 개수를 조정하자.
        * train, valid: 삭제 후 합치자. 그리고 valid 를 생성할 때, 5 % sampling 혹은 영역별로 개수를 조절하거나 1000개와 같이 정확도를 판단하기 쉬운 숫자로 변경해보자.

        * test: 개수가 적으니, 수작업으로 살리자.

        * 추후에 삭제된 데이터들은 수작업으로 살려서 병합하자.


- 데이터 숫자 중복 현황

||train|valid|test|
|:-:|:-:|:-:|:-:|
|AGC|23057|1214|40|
|문제에서 중복된 숫자|3065|165|10|
|제거한 경우|19992|1049|30|

- 제거한 경우, 유형별 비율


||산술연산|도형|수찾기-1|수찾기-2|수찾기-3|크기비교|조합하기|순서정하기|도형고난이도|유형미지정|
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
|train 제거 전|10174|3829|662|752|2822|1378|3008|350|77|5|
|train 제거 대상|1190|199|108|47|612|116|795|0|0|1|
|train 제거 후|8984|3630|554|705|2210|1262|2213|350|77|4|

<br>

||산술연산|도형|수찾기-1|수찾기-2|수찾기-3|크기비교|조합하기|순서정하기|도형고난이도|유형미지정|
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
|valid 제거 전|555|193|43|31|146|64|154|24|3|1|
|valid 제거 대상|62|10|11|3|36|3|39|0|0|1|
|valid 제거 후|493|183|32|28|110|61|115|24|3|0|

<br>

- 풀이에서도 중복된 숫자를 확인하는 이유

    + SVAMP 와 같이 문제에 숫자로는 존재하지만 쓰이지 않는 경우가 있을 수 있기 때문이다.
    + 5개 문항(81, 302, 174, 1267, 1972) 검토 결과, 결국 그걸 구분해야 해서 다 버릴 수 밖에 없다.


사용가능한 예시

~~~
    "81": {
        "question": "8, 2, 3, 500, 65개 숫자 중 3, 500, 6개는 제외되었습니다. 나머지 숫자의 합은 얼마입니까?",  # 6개가 아니라 65개인 것 같다.
        "equation_op": "8 2 [OP_ADD]",
        "template": "[N0] [N1] [OP_ADD]"
    }
~~~

~~~
    "1267": {
        "question": "홍찬이가 다니는 영어 학원의 학생은 모두 75명입니다. 이 중 1/3은 한울초등학교에 다니고, 한울초등학교에 다니는 학생 중 1/5은 3학년입니다. 영어 학원에 다니는 학생 중 한울초등학교 3학년 학생은 모두 몇 명입니까?",
        "equation_op": "75 1/3 [OP_MUL] 1/5 [OP_MUL]",
        "qtype": "산술연산",
        "checked": false,
        "INC": {
            "[N0]": "75",
            "[N1]": "1/3",
            "[N2]": "1/5",
            "[N3]": "3",
            "[N4]": "3"
        },
        "IXC": {},
        "IEC": {},
        "ISC": {
            "[S0]": "영어"
        },
        "IMQ": "홍찬이가 다니는 [S0] 영어 학원의 학생은 모두 [N0] 75명입니다. 이 중 [N1] 1/3은 한울초등학교에 다니고, 한울초등학교에 다니는 학생 중 [N2] 1/5은 [N3] 3학년입니다. [S0] 영어 학원에 다니는 학생 중 한울초등학교 [N4] 3학년 학생은 모두 몇 명입니까?",
        "NET": "[N0] [N1] [OP] [N2] [OP]",
        "template": "[N0] [N1] [OP_MUL] [N2] [OP_MUL]"
    }
~~~

사용불가한 예시

~~~
    "174": {
        "question": "농구공 1개, 축구공 1개, 농구공 1개가 있습니다. 공을 바구니에 넣고 각각의 무게를 잰다면 축구공의 무게는 590g이고 농구공의 무게는 700g입니다. 바구니에 담긴 축구공과 농구공의 무게가 1kg이고 140g이라면 바구니의 무게는 얼마입니까?",  # 1kg 이고 140 g 보다는 1.14kg 와 같은 표현이 적절해보인다.
        "equation_op": "590 700 [OP_ADD] 1 1000 [OP_MUL] 140 [OP_ADD] [OP_SUB]",
        "template": "[N3] [N4] [OP_ADD] [N0] [C1000] [OP_MUL] [N6] [OP_ADD] [OP_SUB]"
    }
~~~

~~~
    "302": {
        "question": "오늘, 첫날에는 18개의 박테리아가 있습니다. 이 박테리아의 수는 둘째 날에 2배가 되고 다음 날에는 2배가 됩니다. 4일째에 자라난 박테리아는 몇 개나 될까요?",
        "equation_op": "18 2 4 1 [OP_SUB] [OP_POW] [OP_MUL]",
        "qtype": "산술연산",
        "checked": false,
        "INC": {
            "[N0]": "18",
            "[N1]": "2",
            "[N2]": "2",
            "[N3]": "4"
        },
        "IXC": {},
        "IEC": {},
        "ISC": {},
        "IMQ": "오늘, 첫날에는 [N0] 18개의 박테리아가 있습니다. 이 박테리아의 수는 둘째 날에 [N1] 2배가 되고 다음 날에는 [N2] 2배가 됩니다. [N3] 4일째에 자라난 박테리아는 몇 개나 될까요?",
        "NET": "[N0] [N1] [N3] [C1] [OP] [OP] [OP]",
        "template": "[N0] [N1] [N3] [C1] [OP_SUB] [OP_POW] [OP_MUL]"
    }
~~~

~~~
    "1972": {
        "question": "밑변 길이가 3이고 높이가 3인 평행사변형의 면적을 찾으십시오.",
        "equation_op": "3 2 [OP_POW]",
        "qtype": "도형",
        "checked": false,
        "INC": {
            "[N0]": "3",
            "[N1]": "3"
        },
        "IXC": {},
        "IEC": {},
        "ISC": {},
        "IMQ": "밑변 길이가 [N0] 3이고 높이가 [N1] 3인 평행사변형의 면적을 찾으십시오.",
        "NET": "[N0] [C2] [OP]",
        "template": "[N0] [C2] [OP_POW]"
    }
~~~


- train, valid 삭제 후 최종 개수

    + 삭제 후, 합친 뒤에 유형별로 95%, 5% 로 ramdon sampling 하였음.

||train|valid|
|:-:|:-:|:-:|
|크기비교|1256|67|
|산술연산|9004|474|
|수찾기-1|556|30|
|도형고난이도|76|4|
|유형미지정|3|1|
|도형|3623|191|
|수찾기-3|2204|116|
|순서정하기|355|19|
|수찾기-2|696|37|
|조합하기|2212|117|
|총|19985|1056|

- test 수정
    + 4번은 수정할 필요는 없어보임.
    + 11번, 12번, 13번, 18번, 19번, 28번, 29번, 30번, 35번

    + 조합하기 문항이 1,2,3 3개의 숫자를 뽑아 세자리수를 만든다 등 에서 중복될 확률이 높음.
    + LIST 연산자가 1과 2 등의 파라미터를 요구하는데, 이걸 CONST 로 표기하지 않으면 N 으로 처리되는 것 같음.

<br>

2. mBERT_LSTM 성능 저하 원인 파악

- learning rate: 3e-5

- scheduler 로 인한 문제인지 확인중

    + GPU 이슈로 인해 실험이 계속 지연되고 있음...
    (학습이 갑자기 accuracy 가 폭락하거나, 학습시간이 2분에서 갑자기 1시간 이상 걸림)
